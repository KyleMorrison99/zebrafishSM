---
title: "zf_sm_code"
authors: "Kyle Morrison, Yefeng Yang, Manuela Santana, Malgorazata Lagisz and, Shinichi Nakagawa"
output: html_document
date: "2023-03-01"
---

Mapping the Behavioral Impacts of Pesticide Exposure on Zebrafish: A Systematic Evidence Map and Bibliometric Analysis

In this Rmarkdown we provide the following workflow:

- Objective 1.	To investigate the types of pesticides and pesticide classes, both in terms of chemical and target, that have been used in experiments examining the effects of pesticide exposure on zebrafish behaviour.

- Objective 2.	To identify the specific behaviours that have been investigated in pesticide exposure experiments that use zebrafish as a model.

- Objective 3.	To identify similarities and differences in research patterns and terminology across different disciplines.

- Objective 4. To examine how are authors connected between countries and how is the literature connected between and within disciplines. 

```{r setup, , results="hide"}
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(tidyverse,
               here,
               stringr,
               knitr,
               formatR,
               forcats,
               ggplot2,
               hrbrthemes,
               patchwork,
               bibliometrix,
               igraph,
               tidyr)
```


All extracted data is stored in five separate **.csv** files representing different aspects of the data (extracted via structured predefined Google Forms - one per table). 

Bibliographic data records are exported from Scopus (including cited references field) in .bib format and locally saved as **scopus.bib**.    

```{r load data}
bib <- read_csv(here("data", "zf_sm_bibliometrics.csv"), skip = 0)
sd <- read_csv(here("data","zf_sm_study_details.csv"), skip = 0)
pd <- read_csv(here("data", "zf_sm_pesticide_details.csv"), skip = 0)
pdo <-read_csv(here("data","zf_sm_pesticide_dosage.csv"), skip = 0)
bd <- read_csv(here("data", "zf_sm_behaviour_details.csv"), skip = 0)

# not to self to create a the bibliometric information 
```


```{r joining data}
# Left join study details to bibliometrics
bib_sd <- left_join(bib, sd, by = "study_id")

# Left join pesticide details to previous join
bib_sd_pd <- left_join(bib_sd, pd, by = "study_id")

# Left join pesticide dosage to previous join
bib_sd_pd_pdo <- left_join(bib_sd_pd, pdo, by = "study_id")

# Left join behaviour details to previous join
fd <- left_join(bib_sd_pd_pdo, bd, by = "study_id")

# view(fd)
```

```{r clean final data}
# removing timestamps and initals extaction

fd <- fd %>% 
           select(-starts_with("timestamp"), -starts_with("initials_extractor"))

# view(fd)
```


```{r fig 1 time trends}

fig1 <- fd %>% 
  count(publication_year) %>%
  ggplot(aes(x = publication_year, y = n)) +
  geom_col(width = 0.7, fill = "black") +
  geom_text(aes(label = n), vjust = -0.2, size = 3.5) +
  theme_classic() +
  labs(x = "Year", y = "Article count") +
  theme(legend.position = "none", 
        axis.title.x = element_text(size = 10),
        axis.text.x = element_text(angle = 45, hjust = 1))
# fig1
```


- Objective 1.	To investigate the types of pesticides and pesticide classes, both in terms of chemical and target, that have been used in experiments examining the effects of pesticide exposure on zebrafish behaviour.


```{r plot for total of individual pesticide}

fig2 <- fd %>%
  count(pesticide_investigated.y) %>%
  ggplot(aes(x = n, y = reorder(pesticide_investigated.y, n))) +
  geom_bar(stat = "identity", fill = "black", color = "white", position = position_dodge(0.9)) +
  geom_text(aes(label = n), position = position_stack(vjust = 0.5), color = "white", fontface = "bold", size = 2) +  
  labs(title = "Total Number of Pesticides Investigated",
       x = "Count",
       y = "Pesticide") +
  theme_classic()

fig2
```

```{r total for target class}
fig3 <- fd %>%
  separate_rows(pesticide_target_class, sep = ", ") %>%  
  count(pesticide_target_class) %>%
  ggplot(aes(x = n, y = reorder(pesticide_target_class, n))) +
  geom_bar(stat = "identity", fill = "black", color = "white", position = position_dodge(0.9)) +
  geom_text(aes(label = n), position = position_stack(vjust = 0.5), color = "white", fontface = "bold", size = 3) +
  labs(title = "Total Number of Pesticides by Target Class",
       x = "Count",
       y = "Pesticide Target Class") +
  theme_classic()

fig3
```


```{r total for chemical class}
fig4 <- fd %>%
  separate_rows(pesticide_chemical_class, sep = ", ") %>%  
  count(pesticide_chemical_class) %>%
  ggplot(aes(x = n, y = reorder(pesticide_chemical_class, n))) +
  geom_bar(stat = "identity", fill = "black", color = "white", position = position_dodge(0.9)) +
  geom_text(aes(label = n), position = position_stack(vjust = 0.5), color = "white", fontface = "bold", size = 3) +
  labs(title = "Total Number of Pesticides by Chemical Class",
       x = "Count",
       y = "Pesticide Chemical Class") +
  theme_classic()

fig4
```

```{r total route of exposure completed as a percentage}
# Calculate total count for each category
total_count <- fd %>% count(route)

# Calculate proportion and percentage for each category
route_pct <- fd %>%
  count(route) %>%
  mutate(proportion = n/sum(total_count$n),
         percentage = proportion*100)

# Create bar plot with percentages
fig4 <- ggplot(route_pct, aes(x = reorder(route, percentage), y = percentage)) +
  geom_bar(stat = "identity", fill = "black", color = "white") +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), hjust = -0.1) +
  labs(title = "Percentage of Pesticides by Route of Exposure",
       x = "Route of Exposure",
       y = "Percentage") +
  theme_classic() +
  coord_flip()

fig5
```



I need to discuss how we will map dosages - do we do range for most common pesticides - we need to keep route consistent for this 


