---
title: "Mapping the Behavioural Impacts of Pesticide Exposures on Zebrafish: A Systematic Evidence Map and Bibliometric Analysis "
authors: "Kyle Morrison, Manuela Santana, Yefeng Yang, Malgorazata Lagisz and, Shinichi Nakagawa"
subtitle: Supplemental file s2
output: 
  rmdformats::robobook:
    code_folding: show
    code_download: true
    toc_depth: 4
editor_options: 
  chunk_output_type: console
  

---

In this Rmarkdown we provide the following workflow:

- Objective 1.	To investigate the types of pesticides and pesticide classes, both in terms of chemical structure and target organism, that have been used in studies examining the effects of pesticide exposure on non-larval zebrafish behaviour.

- Objective 2. To investigate pesticide exposure study designs such as concentration and duration of exposure, life stages of zebrafish used in each study and the sample sizes used. 

- Objective 3.	To identify the specific behaviours that have been investigated in pesticide exposure experiments that use zebrafish as a model.

- Objective 4.	To assess the research outputs of different countries and investigate the level of collaboration between authors amongst different countries. 

# **Load packages and data**

## Load packages

```{r setup, results="hide"}
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(tidyverse,
               here,
               stringr,
               knitr,
               formatR,
               forcats,
               ggplot2,
               hrbrthemes,
               patchwork,
               bibliometrix,
               igraph,
               tidyr,
               viridis,
               circlize,
               cowplot,
               mapproj)
```


## Load data
All extracted data is stored in five separate **.csv** files representing different aspects of the data (extracted via structured predefined Google Forms - one per table). 

Bibliographic data records are exported from Scopus (including cited references field) in .bib format and locally saved as **scopus.bib**.    

```{r}
bib <- read_csv(here("data", "zf_sm_bibliometrics.csv"), skip = 0)
sd <- read_csv(here("data","zf_sm_study_details.csv"), skip = 0) 
pd <- read_csv(here("data", "zf_sm_pesticide_details.csv"), skip = 0)
pdo <-read_csv(here("data","zf_sm_pesticide_dosage.csv"), skip = 0)
bd <- read_csv(here("data", "zf_sm_behaviour_details.csv"), skip = 0)
bib_sco <- convert2df(here("data","scopus.bib"), dbsource = "scopus", format = "bibtex")
```

# Time trends 
## fig 2- study time time trends
```{r}

fig2 <- bib %>% 
  count(publication_year) %>%
  ggplot(aes(x = publication_year, y = n)) +
   geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +
  geom_text(aes(label = n), position = position_stack(vjust = 0.5), fontface = "bold", color = "white", size = 5, hjust = 0.5) +
  theme_minimal() +
  labs(x = "Year", y = "Article Count") +
  theme(legend.position = "none", 
    axis.title.x = element_text(size = 15, face = "bold"),
    axis.title.y = element_text(size = 15, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1, size = 13),
    axis.text.y = element_text(size = 10),
    panel.grid.major.y = element_line(color = "gray"),
    panel.grid.minor.y = element_blank(),
    plot.title = element_text(size = 16, face = "bold")) 

#fig2
#ggsave(here("figures", "fig2_time_trends.pdf"), width = 10, height = 8, units = "cm", scale = 2, dpi = 300, device = cairo_pdf)
```


#  Objective 1.	To investigate the types of pesticides and pesticide classes, both in terms of chemical and target, that have been used in experiments examining the effects of pesticide exposure on zebrafish behaviour.

## fig3a - plot for total of individual pesticides used in pesticide exposure studies
```{r}
fig3a <- pd %>%
  separate_rows(pesticide_investigated, sep = ", ") %>%
  count(pesticide_investigated) %>%
  filter(n>1) %>% 
  ggplot(aes(x = n, y = reorder(pesticide_investigated, n))) +
  geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +
  geom_text(aes(label = n), position = position_stack(vjust = 0.5), color = "white", fontface = "bold", size = 5) +
  labs(x = "Count", y = "Pesticide") +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
        axis.line.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.title.x = element_text(size = 15),
        axis.title.y = element_text(size = 15),
        axis.text.x = element_text(size = 15, hjust = 0),
        axis.text.y = element_text(size = 15, hjust = 1),
        axis.title = element_text(size = 15),
        plot.title = element_blank()) +
        coord_cartesian(xlim = c(0, 11))



 fig3a
```

## fig3b - total for each pesticide target class used in pesticide exposure studies
```{r}
fig3b <- pd %>%
  separate_rows(pesticide_target_class, sep = ",\\s*") %>%  
  count(pesticide_target_class) %>%
  ggplot(aes(x = n, y = reorder(pesticide_target_class, n))) +
geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +  geom_text(aes(label = n), position = position_stack(vjust = 0.5), color = "white", fontface = "bold", size = 5) +
  labs(title = "Total Number of Pesticides by Target Class",
       x = "Count",
       y = "Pesticide Target Class") +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15, hjust = 0),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank()
  )

 fig3b
```

## fig3c - total for chemical class 
```{r} 
fig3c <- pd %>%
  separate_rows(pesticide_chemical_class, sep = ",\\s*") %>%  
  count(pesticide_chemical_class) %>%
  filter(n >1) %>% 
  ggplot(aes(x = n, y = reorder(pesticide_chemical_class, n))) +
  geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +
  geom_text(aes(label = n), position = position_stack(vjust = 0.5), color = "white", fontface = "bold", size = 5) +
  labs(title = "Total Number of Pesticides by Chemical Class",
       x = "Count",
       y = "Pesticide Chemical Class") +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15, hjust = 0),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank()
  )

fig3c
```

##fig3 combined 
```{r}
fig3 <- ((fig3a)  | (fig3b / fig3c)  + plot_annotation(tag_levels = "A")) # note that we filter  2c for those greater than 1
fig3
```

Objective 2. To investigate pesticide exposure study designs such as concentration and duration of exposure, life stages of zebrafish used in each study and the sample sizes used.

## figs3 - total route of exposure completed as a percentage
```{r}
total_route_count <- pdo %>% count(route)

# Calculate proportion and percentage for each category
route_pct <- pdo %>%
  count(route) %>%
  mutate(proportion = n/sum(total_route_count$n),
         percentage = proportion*100)

# Create bar plot with percentages
figs3 <- ggplot(route_pct, aes(x = reorder(route, percentage), y = percentage)) +
  geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), hjust = -0.2, vjust = 0.5, size = 5, fontface = "bold") +
  labs(title = "Percentage of Pesticides by Route of Exposure",
       x = "Route of Exposure",
       y = "Percentage") +
   theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
        axis.text.x = element_text(size = 15, hjust = 0),
        axis.text.y = element_text(size = 15, hjust = 1),
        axis.title.x = element_text(size = 15),
        axis.title.y = element_text(size = 15),
       plot.title = element_blank()) +
       coord_flip() + 
       ylim(0, 100)


figs3
```


# making dosages consistent for dosage comparisons
```{r}
pdo <- pdo %>%
  filter(!is.na(dosage_lowest)) %>% # remove rows with NA values
  mutate(dosage_lowest = as.numeric(dosage_lowest),
         dosage_lowest_unit = as.character(dosage_lowest_unit),
         dosage_unit_consistent = case_when(
           dosage_lowest_unit == "mg/L" ~ "ug/L",
           dosage_lowest_unit == "ng/L" ~ "ug/L",
           dosage_lowest_unit == "g/L" ~ "ug/L",
          dosage_lowest_unit == "ppb" ~ "ug/L",
            dosage_lowest_unit == "ppm" ~ "ug/L",
          dosage_lowest_unit == "ug/g" ~ "mg/kg",
           TRUE ~ dosage_lowest_unit
         ),
         dosage_lowest_convert_ugL = case_when(
           dosage_lowest_unit == "mg/L" ~ dosage_lowest * 1000,
           dosage_lowest_unit == "ng/L" ~ dosage_lowest / 1000,
           dosage_lowest_unit == "g/L" ~ dosage_lowest/1000000,
           dosage_lowest_unit == "ppm" ~ dosage_lowest/1000,
           TRUE ~ dosage_lowest
         ),dosage_highest = as.numeric(dosage_highest),
         dosage_highest_convert_ugL = case_when(
           dosage_highest_unit == "mg/L" ~ dosage_highest * 1000,
           dosage_highest_unit == "ng/L" ~ dosage_highest / 1000,
           dosage_highest_unit == "g/L" ~ dosage_highest/1000000,
           dosage_highest_unit == "ppm" ~ dosage_highest/1000,
           TRUE ~ dosage_highest
         ))
         

```


## fig4 - comparison of lowest and highest dosages in waterbourne exposure methods
```{r }
pdo_waterbourne <- pdo %>%
  pivot_longer(cols = c(dosage_lowest, dosage_highest), 
               names_to = "dosage_type",
               values_to = "dosage_value") %>% 
  filter(route == "waterbourne", dosage_unit_consistent == "ug/L",
         dosage_number > 1) %>%  #  we had to filter for those studies that gave concentration per litre and exclude those with 1 dosage
  mutate(dosage_type = if_else(dosage_type == "dosage_lowest", "Lowest Dosage Exposed", "Highest Dosage Exposed")) 
 
fig4 <- ggplot(pdo_waterbourne, aes(x = dosage_type, y = log(dosage_value))) +
  geom_violin(fill = "#5F85AE", alpha =0.2, color = NA, trim = FALSE) +
  geom_boxplot(width = 0.05, fill = "white", color = "#5F85AE", outlier.shape = NA) +
  geom_jitter(width = 0.1, height = 0.05, color = "#5F85AE", alpha = 0.8) +
  labs(title = "Waterborne Exposures by Dosage in ug/L", x = "Waterborne Exposure", y = "log(Dosage (ug/L))") +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank())

fig4

```

## figs4 - comparison of lowest and highest dosages of waterbourne exposure to deltamethrin
```{r}
pdo_waterbourne_deltamethrin <- pdo %>%
  pivot_longer(cols = c(dosage_lowest, dosage_highest), 
               names_to = "dosage_type",
               values_to = "dosage_value") %>% 
  filter(route == "waterbourne", dosage_unit_consistent == "ug/L", pesticide_investigated == "deltamethrin") %>%  # we had to filter for those studies that gave concentration per litre
  mutate(dosage_type = if_else(dosage_type == "dosage_lowest", "Lowest Dosage Exposed", "Highest Dosage Exposed"))


figs4 <- ggplot(pdo_waterbourne_deltamethrin, aes(x = dosage_type, y = log(dosage_value))) +
   geom_violin(fill = "#5F85AE", alpha = 0.2, color = NA, trim = FALSE) +
  geom_boxplot(width = 0.05, fill = "white", color = "#5F85AE", outlier.shape = NA) +
  geom_jitter(width = 0.1, height = 0.05, color = "#5F85AE", alpha = 0.5) +
  labs(title = "Waterborne Exposures of Deltamethrin by Dosage in ug/L", x = "Waterbourne exposure", y = "log(Dosage (ug/L))")  +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank())
figs4
```

## figs5 - comparison of lowest and highest dosages of waterbourne exposure to rotenone
```{r}
pdo_waterbourne_rotenone<- pdo %>%
  pivot_longer(cols = c(dosage_lowest, dosage_highest), 
               names_to = "dosage_type",
               values_to = "dosage_value") %>% 
  filter(route == "waterbourne", dosage_unit_consistent == "ug/L", pesticide_investigated == "rotenone") %>%  
  mutate(dosage_type = if_else(dosage_type == "dosage_lowest", "Lowest Dosage Exposed", "Highest Dosage Exposed"))

figs5 <- ggplot(pdo_waterbourne_rotenone, aes(x = dosage_type, y = log(dosage_value))) +
  geom_violin(fill = "#5F85AE", alpha = 0.3, trim = FALSE, color = NA) +
  geom_boxplot(width = 0.05, fill = "white", color = "#5F85AE", outlier.shape = NA) +
  geom_jitter(width = 0.1, height = 0.05, color = "#5F85AE", alpha = 0.5) +
  labs(title = "Waterborne Exposures of Rotenone by Dosage in ug/L", x = "Waterbourne exposure", y = "log(Dosage (ug/L))")  +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank())

figs5

```

## figs6 - comparison of lowest and highest dosages of waterbourne exposure atrazine

```{r}
pdo_waterbourne_atrazine <- pdo %>%
  pivot_longer(cols = c(dosage_lowest, dosage_highest), 
               names_to = "dosage_type",
               values_to = "dosage_value") %>% 
  filter(route == "waterbourne", dosage_unit_consistent == "ug/L", pesticide_investigated == "atrazine") %>%  # we had to filter for those studies that gave concentration per litre
  mutate(dosage_type = if_else(dosage_type == "dosage_lowest", "Lowest Dosage Exposed", "Highest Dosage Exposed"))

fig2h <- ggplot(pdo_waterbourne_atrazine, aes(x = dosage_type, y = log(dosage_value))) +
   geom_violin(fill = "#5F85AE", alpha = 0.3, trim = FALSE, color = "NA") +
  geom_boxplot(width = 0.05, fill = "white", color = "#5F85AE", outlier.shape = NA) +
  geom_jitter(width = 0.1, height = 0.05, color = "#5F85AE", alpha = 0.5) +
  labs(title = "Waterborne Exposures of Atrazine by Dosage in ug/L", x = "Waterborne exposure", y = "log(Dosage (ug/L))")  +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank()) 
fig2h

```

## figs7 - comparison to lowest and highest dosages of waterbourne exposure to glyphosate
```{r}
pdo_waterbourne_glyphosate <- pdo %>%
  pivot_longer(cols = c(dosage_lowest, dosage_highest), 
               names_to = "dosage_type",
               values_to = "dosage_value") %>% 
  filter(route == "waterbourne", dosage_unit_consistent == "ug/L", pesticide_investigated == "glyphosate") %>%  # we had to filter for those studies that gave concentration per litre
  mutate(dosage_type = if_else(dosage_type == "dosage_lowest", "Lowest Dosage Exposed", "Highest Dosage Exposed"))

figs7 <- ggplot(pdo_waterbourne_glyphosate, aes(x = dosage_type, y = log(dosage_value))) +
 geom_violin(fill = "#5F85AE", alpha = 0.3, trim = FALSE, color = NA) +
  geom_boxplot(width = 0.05, fill = "white", color = "#5F85AE", outlier.shape = NA) +
  geom_jitter(width = 0.1, height = 0.05, color = "#5F85AE", alpha = 0.5) +
  labs(title = "Waterborne Exposures of Glyphosate by Dosage in ug/L", x = "Waterbourne exposure", y = "log(Dosage (ug/L))")  +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank())
figs7

```

## figs8  - comparison to lowest and highest dosages of waterbourne exposure to chlopyrifo
```{r}
pdo_waterbourne_chloropyrifo <- pdo %>%
  pivot_longer(cols = c(dosage_lowest, dosage_highest), 
               names_to = "dosage_type",
               values_to = "dosage_value") %>% 
  filter(route == "waterbourne", dosage_unit_consistent == "ug/L", pesticide_investigated == "chloropyrifo") %>%  #we had to filter for those studies that gave concentration per litre
  mutate(dosage_type = if_else(dosage_type == "dosage_lowest", "Lowest Dosage Exposed", "Highest Dosage Exposed"))

figs8 <- ggplot(pdo_waterbourne_chloropyrifo, aes(x = dosage_type, y = log(dosage_value))) +
  geom_violin(fill = "#5F85AE", alpha = 0.3, trim = FALSE, color = NA) +
  geom_boxplot(width = 0.05, fill = "white", color = "#5F85AE", outlier.shape = NA) +
  geom_jitter(width = 0.1, height = 0.05, color = "#5F85AE", alpha = 0.5) +
  labs(title = "Waterborne Exposures of Chloropyrifos by Dosage in ug/L", x = "Waterbourne exposure", y = "log(Dosage (ug/L))")  +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank())
figs8
```

## figs9 - total lifestage of exposure completed as a percentage
```{r}

# Calculate total count for each category
total_count_lse <- sd %>% count(life_stage_exposure)

# Calculate proportion and percentage for each category
life_stage_pct <- sd %>%
    separate_rows(life_stage_exposure, sep = ",\\s*") %>% 
  count(life_stage_exposure) %>%
  mutate(proportion = n/sum(total_count_lse$n),
         percentage = proportion*100)

# Create bar plot with percentages
figs9 <- ggplot(life_stage_pct, aes(x = reorder(life_stage_exposure, percentage), y = percentage)) +
   geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), hjust = -0.2, vjust = 0.5, size = 5, fontface = "bold") +
  labs(title = "Percentage of Pesticides by Life Stage of Exposure",
       x = "Life Stage of Exposure",
       y = "Percentage",
       fontsize = 14) +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank()) +
  coord_flip() + 
  ylim(0, 100)

figs9
```

## figs10  - total sexes exposed completed as a percentage
```{r}
# Calculate total count for each category
total_sex_count <- sd %>% count(sex)

# Calculate proportion and percentage for each category
sex_pct <- sd %>%
  count(sex) %>%
  mutate(proportion = n/sum(total_sex_count$n),
         percentage = proportion*100)

# Create bar plot with percentages
figs10 <- ggplot(sex_pct, aes(x = reorder(sex, percentage), y = percentage)) +
 geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), hjust = -0.2, vjust = 0.5, size = 5, fontface = "bold") +
  labs(title = "Percentage of Pesticides by Sex of Exposure",
       x = "Sex of Exposure",
       y = "Percentage") +
   theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank()) +
  coord_flip() + 
  ylim(0, 100)

figs10
```


# Objective 3.	To identify the specific behaviours that have been investigated in pesticide exposure experiments that use zebrafish as a model.

## fig5 - total number of studies investigating each broad behaviour class
```{r}
fig5 <- bd %>%
  separate_rows(behavioural_class, sep = ",\\s*") %>%  
  count(behavioural_class) %>%
  ggplot(aes(x = n, y = reorder(behavioural_class, n))) +
  geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +
  geom_text(aes(label = n), position = position_stack(vjust = 0.5), color = "white", size = 5, hjust = 0.5, fontface = "bold") +
  labs(title = "Total Number of studies investigating each Behavioural Class",
       x = "Count",
       y = "Behavioural Class") +
   theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank())
fig5
```


## figs11 - total number of studies investigating each behavioural assay of behaviour activity
```{r}
figs11 <- bd %>%
  separate_rows(behaviour_activity, sep = ",\\s*") %>%  
  count(behaviour_activity) %>%
   na.omit() %>%
  ggplot(aes(x = reorder(behaviour_activity, n), y = n)) +
  geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +
  geom_text(aes(label = n), position = position_stack(vjust = 0.5), color = "white", size = 5, hjust = 0.5, fontface = "bold") +
  labs(title = "Behavioural assays investigating Activity",
       x = "Activity Assay",
       y = "Count") +
theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank()) +
        coord_flip()

figs11
```

## figs12 - total number of studies investigating each behavioural assay of behaviour_aggression
```{r}
figs12 <- bd %>%
  separate_rows(behaviour_aggression, sep = ",\\s*") %>%  
  count(behaviour_aggression) %>%
  na.omit() %>%
  ggplot(aes(x = reorder(behaviour_aggression, n), y = n)) +
  geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +
  geom_text(aes(label = n), position = position_stack(vjust = 0.5), color = "white", size = 5, hjust = 0.5, fontface = "bold") +
  labs(title = "Behavioural assays investigating Aggression",
       x = "Aggression Assay",
       y = "Count") +
theme_minimal() +
theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank()) +
        coord_flip()
 

figs12
```

## figs13 - total number of studies investigating each behavioural assay of behavioural_sociality
```{r}
figs13 <- bd %>%
  separate_rows(behaviour_sociality, sep = ",\\s*") %>%  
  count(behaviour_sociality) %>%
  na.omit() %>%
  ggplot(aes(x = reorder(behaviour_sociality, n), y = n)) +
  geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +
  geom_text(aes(label = n), position = position_stack(vjust = 0.5), color = "white", size = 5, hjust = 0.5, fontface = "bold") +
  labs(title = "Behavioural assays investigating Sociality",
       x = "Sociality Assay",
       y = "Count") +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank()) +
        coord_flip()
 

figs13
```

## figs14 - total number of studies investigating each behavioural assay of behavioural_foraging
```{r}
figs14 <- bd %>%
  separate_rows(behaviour_foraging, sep = ",\\s*") %>%  
  count(behaviour_foraging) %>%
  na.omit() %>%
  ggplot(aes(x = reorder(behaviour_foraging, n), y = n)) +
    geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +
  geom_text(aes(label = n), position = position_stack(vjust = 0.5), color = "white", size = 4, hjust = 0.5,  fontface = "bold") +
  labs(title = "Behavioural assays investigating Foraging Behaviour",
       x = "Foraging Assay",
       y = "Count") +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank()) +
        coord_flip()
figs14
```

## figs15 - total number of studies investigating each behavioural assay of anti-predator behaviour
```{r}
figs15 <- bd %>%
  separate_rows(behaviour_antipredator, sep = ",\\s*") %>%  
  count(behaviour_antipredator) %>%
  na.omit() %>%
  ggplot(aes(x = reorder(behaviour_antipredator, n), y = n)) +
    geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +
  geom_text(aes(label = n), position = position_stack(vjust = 0.5), color = "white", size = 4, hjust = 0.5, fontface = "bold") +
  labs(title = "Behavioural assays investigating Anti-Predator Behaviour",
       x = "Antipredator Assay",
       y = "Count") +
    theme_minimal() +
theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank()) +
        coord_flip()

figs15
```

## figs16 - total number of studies investigating each behavioural assay of Anxiety or Boldness behaviour
```{r}
figs16 <- bd %>%
  separate_rows(behaviour_anxiety, sep = ",\\s*") %>%  
  count(behaviour_anxiety) %>%
  na.omit() %>%
  ggplot(aes(x = reorder(behaviour_anxiety, n), y = n)) +
    geom_bar(stat = "identity", fill = "#5F85AE", color = "white", alpha = 0.8, position = position_dodge(0.9)) +
  geom_text(aes(label = n), position = position_stack(vjust = 0.5), color = "white", size = 5, hjust = 0.5, fontface = "bold") +
  labs(title = "Behavioural assays investigating Boldness or Anxiety Behaviour",
       x = "Boldness or Anxiety Assay",
       y = "Count") +
    theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank()) +
        coord_flip()

figs16
```


## figs17 - heat map to show which behavours have been investigated in which pesticide target class
```{r}
bd_pd <- left_join(bd, pd, by = "study_id")

bd_pd1 <- separate_rows(bd_pd, behavioural_class, sep = ",\\s*", convert = TRUE)
bd_pd1<- separate_rows(bd_pd1, pesticide_target_class, sep = ",\\s*", convert = TRUE)

bd_pd_summary1 <- bd_pd1 %>%
  mutate(behavioural_class = str_trim(behavioural_class),
         pesticide_target_class = str_trim(pesticide_target_class)) %>%
  group_by(behavioural_class, pesticide_target_class) %>%
  summarise(count = n()) %>%
  ungroup() 

# Create a heatmap using ggplot2
figs17 <- ggplot(bd_pd_summary1, aes(x = pesticide_target_class, y = behavioural_class, fill = count)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "#F0F4F8", high = "#446487") +
  geom_text(aes(label = count), color = "black", size = 4) +  # Add text labels
  labs(x = "Pesticide Target Class", y = "Behavioural Class", fill = "Count") +
  theme_minimal() +
 theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank())


figs17
```

## figs18 - heat map to show which behavours have been investigated in which pesticide chemical class
```{r}
bd_pd2 <- separate_rows(bd_pd, behavioural_class, sep = ",\\s*", convert = TRUE)
bd_pd2 <- separate_rows(bd_pd2, pesticide_chemical_class, sep = ",", convert = TRUE)

# Get the top 5 most numerous pesticide chemical classes
bd_pd_summary2 <- bd_pd2 %>%
  mutate(behavioural_class = str_trim(behavioural_class),
         pesticide_target_class = str_trim(pesticide_chemical_class)) %>%
  group_by(behavioural_class, pesticide_chemical_class) %>%
  summarise(count = n()) %>%
  ungroup() 

top_pesticide_classes <- bd_pd_summary2 %>%
  filter(!is.na(pesticide_chemical_class)) %>%
  group_by(pesticide_chemical_class) %>%
  summarise(count = sum(count)) %>%
  ungroup() %>%
  top_n(3, count) %>% # filtered for the top three 
  pull(pesticide_chemical_class)

# Subset the data to include only the top 5 classes
bd_pd_summary_top5 <- bd_pd_summary2 %>%
  filter(pesticide_chemical_class %in% top_pesticide_classes)

# Create a heatmap using ggplot2
figs18 <- ggplot(bd_pd_summary_top5, aes(x = pesticide_chemical_class, y = behavioural_class, fill = count)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "#F0F4F8", high = "#446487") +
  geom_text(aes(label = ifelse(count > 0, count, "")), color = "black", size = 4) +  # Add text labels
  labs(x = "Pesticide Chemical Class", y = "Behavioural Class", fill = "Count") +
  theme_minimal() +
 theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank())
figs18

```

## figs19 - heat map to show which life stages of exposure have been exposed to each pesticide chemical class
```{r}

sd_pd <- left_join(sd, pd, by = "study_id")

sd_pd1 <- separate_rows(sd_pd, life_stage_exposure, sep = ",", convert = TRUE)
sd_pd1 <- separate_rows(sd_pd1, pesticide_chemical_class, sep = ",", convert = TRUE)

sd_pd_summary1 <- sd_pd1 %>%
  mutate(life_stage_exposure = str_trim(life_stage_exposure),
         pesticide_chemical_class = str_trim(pesticide_chemical_class)) %>%
  group_by(life_stage_exposure, pesticide_chemical_class) %>%
  summarise(count = n()) %>%
  ungroup()

top_pesticide_classes <- sd_pd_summary1 %>%
  filter(!is.na(pesticide_chemical_class)) %>%
  group_by(pesticide_chemical_class) %>%
  summarise(count = sum(count)) %>%
  ungroup() %>%
  top_n(4, count) %>%
  pull(pesticide_chemical_class)

sd_pd_summary1_top5 <- sd_pd_summary1 %>%
  filter(pesticide_chemical_class %in% top_pesticide_classes)

figs19 <- ggplot(sd_pd_summary1_top5, aes(x = pesticide_chemical_class, y = life_stage_exposure, fill = count)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "#F0F4F8", high = "#446487") +
  geom_text(aes(label = ifelse(count > 0, count, "")), color = "black", size = 4) +
  labs(x = "Pesticide Chemical Class", y = "Life Stage Exposure", fill = "Count") +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank())

figs19
```

## figs20 - heat map to show which life stages of exposure have been exposed to each target chemical class
```{r}
sd_pd2 <- separate_rows(sd_pd, life_stage_exposure, sep = ",", convert = TRUE)
sd_pd2 <- separate_rows(sd_pd2, pesticide_target_class, sep = ",", convert = TRUE)

sd_pd_summary2 <- sd_pd2 %>%
  mutate(life_stage_exposure = str_trim(life_stage_exposure),
         pesticide_target_class = str_trim(pesticide_target_class)) %>%
  group_by(life_stage_exposure, pesticide_target_class) %>%
  summarise(count = n()) %>%
  ungroup()

top_pesticide_classes <- sd_pd_summary2 %>%
  filter(!is.na(pesticide_target_class)) %>%
  group_by(pesticide_target_class) %>%
  summarise(count = sum(count)) %>%
  ungroup() %>%
  top_n(5, count) %>%
  pull(pesticide_target_class)

sd_pd_summary2_top5 <- sd_pd_summary2 %>%
  filter(pesticide_target_class %in% top_pesticide_classes)

figs20 <- ggplot(sd_pd_summary2_top5, aes(x = pesticide_target_class, y = life_stage_exposure, fill = count)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "#F0F4F8", high = "#446487") +
  geom_text(aes(label = ifelse(count > 0, count, "")), color = "black", size = 4) +
  labs(x = "Pesticide Target Class", y = "Life Stage Exposure", fill = "Count") +
  theme_minimal() +
theme(panel.grid.major.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size = 15),
    axis.text.y = element_text(size = 15, hjust = 1),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    plot.title = element_blank())
figs20                                     

```


# Objective 3. To examine how are authors connected between countries and how is the literature connected between and within disciplines.

## figs24 - general bibliometric summaries
```{r}
figs24 <- biblioAnalysis(bib_sco)
plot(figs24)
```

## figs27 - co-occurance matrix
```{r}
NetMatrix_keywords <- biblioNetwork(bib_sco, analysis = "co-occurrences", network = "keywords", sep = ";")
figs25 <- networkPlot(NetMatrix_keywords, normalize="association", n = 10, 
                     Title = "Keyword Co-occurrences", type = "fruchterman", 
                     size.cex = TRUE, size = 10, remove.multiple = F, 
                     edgesize = 4, labelsize = 3, label.cex = TRUE, 
                     edges.min = 2, label.n = 9, alpha = 0.3) 
```

## fig s26 - thematic map based on keywords
```{r}
par(mfrow=c(1,1), mar=c(0,2,0,2))
figs26 <- thematicMap(bib_sco, field = "ID", n = 1000, minfreq = 5, stemming = FALSE, size = 0.5, n.labels = 1, repel = TRUE)
plot(figs26$map)

```

## fig5e - country publications map
```{r}

bibmap <- metaTagExtraction(bib_sco, Field = "AU1_CO", sep = ";") 
bibmap <- metaTagExtraction(bibmap, Field = "AU_CO", sep = ";") 
#save counts in a data frame
bibmap %>% group_by(AU1_CO) %>% count() %>% filter(!is.na(AU1_CO)) -> firstcountrycounts
#load map data
world_map <- map_data("world") %>% 
  filter(! long > 180) #remove countries with longitude >180 to make equal projection-like map without artifacts
#table(world_map$region) #note that United Kingdom is UK here
# Format country names to match regions on the world map
firstcountrycounts$region <- str_to_title(firstcountrycounts$AU1_CO)
firstcountrycounts$region[firstcountrycounts$region == "Usa"] <- "USA" #Fix "Usa" to "USA" :
firstcountrycounts$region[firstcountrycounts$region == "Korea"] <- "South Korea"


#(firstcountrycounts$region) %in% world_map$region #check matching
## colour all regions on the map:
emptymap <- tibble(region = unique(world_map$region), n = rep(0,length(unique(world_map$region)))) #create table with all counts as 0
fullmap <- left_join(emptymap, firstcountrycounts, by = "region") #join with actual counts table
fullmap$n <- fullmap$n.x + fullmap$n.y # make new column for fixed counts
fullmap$n[is.na(fullmap$n)] <- 0 #change NA to 0 for regions with no counts
figs27 <- fullmap %>% 
  ggplot(aes(fill = n, map_id = region)) +
  geom_map(map = world_map) +
  expand_limits(x = world_map$long, y = world_map$lat) +
  coord_map("moll") +
  theme_map(line_size = 0.5) + 
  theme(legend.position="right") +
  scale_fill_gradient(low = "#7BCCC4", high = "#084081",
                    name = "Score", na.value = "gray50",
 limits = c(0.1, 25),
      guide = guide_colorbar(direction = "vertical.")) +
  guides(fill = guide_colourbar(barwidth = unit(15, units = "mm"), barheight = unit(20, units = "mm")))
figs27
```

## figs28 - country collaboration network circle plot
```{r}
# Extract countries from the affiliations
bib_sco2 <- metaTagExtraction(bib_sco, Field = "AU_CO", sep = ";")

# Create a network matrix of collaborations between countries
NetMatrix_country <- biblioNetwork(bib_sco2, analysis = "collaboration", network = "countries", sep = ";")

# Convert the network matrix to a standard matrix
NetMatrix_country <- as.matrix(NetMatrix_country)

# Remove the lower triangle (as this is duplication of info)
NetMatrix_country[lower.tri(NetMatrix_country)] <- 0 

# Change column and row names to title case
colnames(NetMatrix_country) <- str_to_title(colnames(NetMatrix_country))
rownames(NetMatrix_country) <- str_to_title(rownames(NetMatrix_country))

# Change "Usa" to "USA"
colnames(NetMatrix_country)[colnames(NetMatrix_country) == "Usa"] <- "USA"
rownames(NetMatrix_country)[rownames(NetMatrix_country) == "Usa"] <- "USA"

# Change "United Kingdom" to "UK" for easier plotting
colnames(NetMatrix_country)[colnames(NetMatrix_country) == "United Kingdom"] <- "UK"
rownames(NetMatrix_country)[rownames(NetMatrix_country) == "United Kingdom"] <- "UK"

# Define colors for each country
my.cols2 <- c(
  USA = "#377eb8",
  China = "#e41a1c",
  Brazil = "#4daf4a",
  Switzerland = "#984ea3",
  Norway = "#ff7f00",
  Mexico = "#a65628",
  Ecuador = "#f781bf",
  UK = "#ffff33",
  Philippines = "#a65628",
  Netherlands = "#377eb8",
  Italy = "#e41a1c",
  Sweden = "#4daf4a",
  Portugal = "#984ea3", 
  Korea = "#f781bf",
  France = "#999999",
  Chile = "#ff7f00",
  Spain = "#ffff33", 
  Cananda = "#a6cee3",
  India = "#1f78b4",
  Germany = "#b2df8a",
  Turkey = "#33a02c",
  Romania = "#fb9a99"
)


# Create a chord diagram of the network matrix
figs28 <- chordDiagram(NetMatrix_country, annotationTrack = "grid", preAllocateTracks = 1, grid.col = my.cols2)

# Add a track to label each sector with its name
circos.trackPlotRegion(track.index = 1, panel.fun = function(x, y) {
  xlim = get.cell.meta.data("xlim")
  ylim = get.cell.meta.data("ylim")
  sector.name = get.cell.meta.data("sector.index")
  circos.text(mean(xlim), ylim[1] + .1, sector.name, facing = "clockwise", niceFacing = TRUE, adj = c(0, 0.5))
  circos.axis(h = "top", labels.cex = 0.5, major.tick.length = 0.2, sector.index = sector.name, track.index = 2)
}, bg.border = NA)

```

## fig6a collaboration matrix with self citation removed
```{r}

diag(NetMatrix_country) <- 0

# Create a chord diagram of the network matrix
fig6a <- chordDiagram(NetMatrix_country, annotationTrack = "grid", preAllocateTracks = 1, grid.col = my.cols2)

# Add a track to label each sector with its name
circos.trackPlotRegion(track.index = 1, panel.fun = function(x, y) {
  xlim = get.cell.meta.data("xlim")
  ylim = get.cell.meta.data("ylim")
  sector.name = get.cell.meta.data("sector.index")
  circos.text(mean(xlim), ylim[1] + .1, sector.name, facing = "clockwise", niceFacing = TRUE, adj = c(0, 0.5))
  circos.axis(h = "top", labels.cex = 0.5, major.tick.length = 0.2, sector.index = sector.name, track.index = 2)
}, bg.border = NA)
```

## fig6b continent collaboration 
```{r}
NetMatrix_continent <- NetMatrix_country
# Change "Usa" to "North America"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "USA"] <- "North America"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "USA"] <- "North America"
# Change "Usa" to "North America"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Canada"] <- "North America"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Canada"] <- "North America"
# Change "Mexico" to "North America"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Mexico"] <- "North America"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Mexico"] <- "North America"
# Change China to Asia
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "China"] <- "Asia"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "China"] <- "Asia"
# Change India to Asia
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "India"] <- "Asia"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "India"] <- "Asia"
# Change Phillipines to Asia
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Philippines"] <- "Asia"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Philippines"] <- "Asia"
# Change "Brazil" to "South America"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Brazil"] <- "South America"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Brazil"] <- "South America"
# Change "Ecuador" to "South America"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Ecuador"] <- "South America"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Ecuador"] <- "South America"
# Change "Chile" to "South America"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Chile"] <- "South America"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Chile"] <- "South America"
# Change "United Kingdom" to "Europe" 
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) =="UK"] <- "Europe"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) =="UK"] <- "Europe"
# Change "Romania" to "Europe"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Romania"] <- "Europe"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Romania"] <- "Europe"
# Change "Germany" to "Europe"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Germany"] <- "Europe"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Germany"] <- "Europe"
#Change "France" to "Europe"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "France"] <- "Europe"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "France"] <- "Europe"
#Change "Spain" to "Europe"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Spain"] <- "Europe"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Spain"] <- "Europe"
#Change "Portugal" to "Europe"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Portugal"] <- "Europe"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Portugal"] <- "Europe"
#Change "Sweden" to "Europe"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Sweden"] <- "Europe"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Sweden"] <- "Europe"
#Change "Italy" to "Europe"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Italy"] <- "Europe"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Italy"] <- "Europe"
#Change "Netherlands" to "Europe"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Netherlands"] <- "Europe"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Netherlands"] <- "Europe"
#Change "Norway" to "Europe"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Norway"] <- "Europe"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Norway"] <- "Europe"
#Change "Switzerland" to "Europe"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Switzerland"] <- "Europe"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Switzerland"] <- "Europe"
#Change "Czech Republic" to "Europe"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Czech Republic"] <- "Europe"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Czech Republic"] <- "Europe"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Korea"] <- "Asia"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Korea"] <- "Asia"
colnames(NetMatrix_continent)[colnames(NetMatrix_continent) == "Turkey"] <- "Europe"
rownames(NetMatrix_continent)[rownames(NetMatrix_continent) == "Turkey"] <- "Europe"


# collapsing
merge_matrix <- t(rowsum(t(NetMatrix_continent), group = colnames(NetMatrix_continent), na.rm = T))
merge_matrix2 <- rowsum(merge_matrix, group = rownames(merge_matrix))
# remove diagonal elements
diag(merge_matrix2) <- 0
# chord plot
chordDiagramFromMatrix(merge_matrix2)

# Create a chord diagram of the network matrix
fig6b <- chordDiagram(merge_matrix2, annotationTrack = "grid", preAllocateTracks = 1)
# Add a track to label each sector with its name
circos.trackPlotRegion(track.index = 1, panel.fun = function(x, y) {
  xlim = get.cell.meta.data("xlim")
  ylim = get.cell.meta.data("ylim")
  sector.name = get.cell.meta.data("sector.index")
  circos.text(mean(xlim), ylim[1] + 0.2, sector.name, facing = "clockwise", niceFacing = TRUE, adj = c(0, 1))
  circos.axis(h = "top", labels.cex = 0.5, major.tick.length = 0.2, sector.index = sector.name, track.index = 2)
}, bg.border = NA)

```


now done on vosviewer 
```{r most cited articles and authors}

CR <- citations(bib_sco, field = "article", sep = ";") #list of most cited articles
 cbind(CR$Cited[1:10]) #ten most cited articles
 
CR <- citations(bib_sco, field = "author", sep = ";")
cbind(CR$Cited[1:10]) #ten most cited authors
``` 



this is now being done on vosviewer 
```{r bibliometric coupling network}
NetMatrix_coupling <- biblioNetwork(bib_sco, analysis = "coupling", network = "references", sep = "; ")
NetMatrix_coupling_plot <- networkPlot(NetMatrix_coupling, n = 20, 
                                       Title = "Paper co-citation", type = "fruchterman", size=T, 
                                       remove.multiple=FALSE, labelsize=0.8,edgesize = 5)
```
